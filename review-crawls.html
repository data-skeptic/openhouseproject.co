<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
	<style type="text/css">
	body {
		font-family: sans-serif;
		font-weight: normal;
		color: #999;
	}

	form {
		margin: 2px 0;
		display: inline;
	}

	div {
		clear: both;
		margin: 0 1px;
	}

	label {
	  width: 650px;
	  border-radius: 3px;
	  border: 1px solid #D1D3D4
	}

	/* hide input */
	input.radio:empty {
		margin-left: -999px;
	}

	/* style label */
	input.radio:empty ~ label {
		position: relative;
		float: left;
		line-height: 2.5em;
		text-indent: 3.25em;
		margin-top: 2px;
		cursor: pointer;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}

	input.radio:empty ~ label:before {
		position: absolute;
		display: block;
		top: 0;
		bottom: 0;
		left: 0;
		content: '';
		width: 2.5em;
		background: #D1D3D4;
		border-radius: 3px 0 0 3px;
	}

	/* toggle hover */
	input.radio:hover:not(:checked) ~ label:before {
		content:'\2714';
		text-indent: .9em;
		color: #C2C2C2;
	}

	input.radio:hover:not(:checked) ~ label {
		color: #888;
	}

	/* toggle on */
	input.radio:checked ~ label:before {
		content:'\2714';
		text-indent: .9em;
		color: #9CE2AE;
		background-color: #4DCB6D;
	}

	input.radio:checked ~ label {
		color: #777;
	}

	/* radio focus */
	input.radio:focus ~ label:before {
		box-shadow: 0 0 0 3px #999;
	}
	#rc {
	}
	#h1 {
		font-size: 14pt;
	}
	#btn {
			margin-top: 5px;
			width: 650px;
			height: 50px;
			font-size: 20pt;
		}
	</style>
	<script>
	var rurl = "n/a"

	function doerror() {
		alert("Oh no, we had an error. :(  Check the javascript console.  Please mention this in the #OpenHouse channel on Data Skeptic Slack")
	}

	function go() {
		var btn = $("#btn")
		btn = btn[0]
		btn.disabled = true
		btn.innerText = "Updating..."

		var selected = $("input[name='radio']:checked").val();
		if (selected == undefined) {
			alert("Please select a description from above.")
			return
		}
		var url = "https://5xwvsgjnqi.execute-api.us-east-1.amazonaws.com/prod/crawl-review"
		var s = JSON.stringify({"url": rurl, "status-mask": parseInt(selected)})
		console.log(s)
		$.ajax({
			url: url,
			type: "POST",
			data: s,
			success: function(data, textStatus, jqXHR) {
				var resp = data
				var status = resp['status']
				if (status=="done") {
					$('.radio').prop('checked', false);
					load_next()
				}
				else {
					doerror()
				}
			},
			error: function (jqXHR, textStatus, errorThrown) {
				doerror()
				console.log(textStatus)
				console.log(errorThrown)
			}
		})
		console.log("done")
	}

	function load_next() {
		var btn = $("#btn")
		btn = btn[0]
		btn.disabled = true
		btn.innerText = "Loading..."
		var url = "https://5xwvsgjnqi.execute-api.us-east-1.amazonaws.com/prod/crawl-review"
		console.log(1)
		$.get(url, function(data) {
			var d = data['content']
			rurl = data['url']
			if (d == undefined) {
				console.log(data)
				doerror()
			}
			else {
				console.log(typeof(d))
				try {
					var o = JSON.parse(d)
					d = o['content']
				}
				catch (e) {

				}
				var content = d
				var iframe = document.getElementById('frame')
				iframe.src = 'data:text/html;charset=utf-8,' + encodeURI(content);
				if (rurl == "done") {
					btn.innerText = "Done for now.  Help find more sources!"
					btn.disabled = true
				} else {
					btn.disabled = false
					btn.innerText = "Submit"
				}
			}
		})
	}

	$(document).ready(function() {
		load_next()
	});

	</script>
	<div>
		<div>
			<img src="https://raw.githubusercontent.com/data-skeptic/openhouseproject.co/gh-pages/logo.png" width="75" />
		</div>
		<div>
			<h1>The page below...</h1>
				<div class="rc">
					<input class="radio" type="radio" name="radio" value="50" id="radio50" />
					<label for="radio50">has one complete property listing.</label>
				</div>
				<div class="rc">
					<input class="radio" type="radio" name="radio" value="51" id="radio51" />
					<label for="radio51">has many complete property listings.</label>
				</div>
				<div class="rc">
					<input class="radio" type="radio" name="radio" value="52" id="radio52" />
					<label for="radio52">has no useful information on home sales.</label>
				</div>
				<div class="rc">
					<input class="radio" type="radio" name="radio" value="53" id="radio53" />
					<label for="radio53">does not have any sales data but is from a page that should be crawled further.</label>
				</div>
				<div class="rc">
					<input class="radio" type="radio" name="radio" value="54" id="radio54" />
					<label for="radio54">contains an error.</label>
				</div>
				<div>
					<button onClick="go()" id="btn">Submit</button>
				</div>
		</div>
		<div>
			<iframe id="frame" width=100% height=400 src="http://openhouseproject.co/loading.html" />
		</div>
	</div>
</body>
</html>